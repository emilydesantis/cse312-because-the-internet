<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>20 Questions Game</title>
   <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
   <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.3/socket.io.min.js"></script>
   <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
   <div class="container-3">
       <h2>20 Questions Game</h2>
       <p>Room: {{ room_name }}</p>
       <p>Username: {{ username }}</p>
       <p>Role: {{ role }}</p>
       <div id="game-info">
           <h3>Questions Remaining: <span id="questions-left">20</span></h3>
           <div id="word-selection" style="display: none;">
               <h3>Enter a word for the other player to guess:</h3>
               <input type="text" id="word-input" />
               <button id="submit-word">Submit</button>
           </div>
           <div id="gameplay" style="display: none;">
               <div id="questions-container">
                   <h3>Questions and Answers:</h3>
                   <ul id="qa-list"></ul>
               </div>
               <div id="input-container" style="display: none;">
                   <input type="text" id="input-field" />
                   <button id="submit-input">Submit</button>
               </div>
               <div id="yes-no-buttons" style="display: none;">
                   <button id="yes-button">Yes</button>
                   <button id="no-button">No</button>
               </div>
           </div>
       </div>
   </div>
   <script>
       const socket = io.connect('http://' + document.domain + ':' + location.port);
       const roomName = '{{ room_name }}';
       const username = '{{ username }}';
       const role = '{{ role }}';


       socket.emit('join_lobby', {'username': username, 'room_name': roomName});


       if (role === 'select_word') {
           $('#word-selection').show();
           $('#yes-no-buttons').show();
} else if (role === 'ask_questions') {
   $('#gameplay').show();
   $('#input-container').show();
}


       $('#submit-word').click(function() {
           const word = $('#word-input').val();
           socket.emit('submit_word', { room_name: roomName, word: word });
           $('#word-selection').hide();
           $('#gameplay').show();
       });


       $('#submit-input').click(function() {
   const input = $('#input-field').val();
   const is_guess = input.toLowerCase().startsWith('is it');
   if (is_guess) {
       const guessed_word = input.slice(5).trim().toLowerCase();
       if (guessed_word === '{{ game_state[room_name]["word"]|lower }}') {
           socket.emit('correct_guess', { room_name: roomName });
           return;
       }
   }
   socket.emit('submit_question_or_guess', { room_name: roomName, question_or_guess: input, is_guess: is_guess });
   $('#input-field').val('');
});


       $('#yes-button').click(function() {
   socket.emit('submit_answer', { room_name: roomName, answer: 'Yes' });
});


$('#no-button').click(function() {
   socket.emit('submit_answer', { room_name: roomName, answer: 'No' });
});


       socket.on('start_question_round', function() {
           $('#input-container').show();
       });


       socket.on('display_question', function(data) {
           const question = data['question'];
           $('#qa-list').append('<li class="question">' + question + '</li>');
           updateQuestionsLeft();
       });


       socket.on('show_answer', function(data) {
           const answer = data['answer'];
           $('#qa-list').append('<li class="answer">' + answer + '</li>');
       });


       function updateQuestionsLeft() {
           const currentQuestionsLeft = parseInt($('#questions-left').text());
           $('#questions-left').text(currentQuestionsLeft - 1);
       }


       socket.on('disable_yes_no_buttons', function() {
   if (role === 'select_word') {
       $('#yes-button').prop('disabled', true);
       $('#no-button').prop('disabled', true);
   }
});


socket.on('ask_for_answer', function(data) {
   if (role === 'select_word') {
       $('#yes-button').prop('disabled', false);
       $('#no-button').prop('disabled', false);
   }
});




       socket.on('game_over', function(data) {
       const result = data['result'];
       if (result === 'win') {
           alert('Congratulations! You correctly guessed the word!');
       } else if (result === 'lose') {
           alert('Game over! You ran out of questions without guessing the word.');
       } else {
           alert('An error occurred, please try again.');
       }
       window.location.href = '/';
   });
</script>
